// TODO: iteratively get transient entities and retry merge until one of the following conditions:
// Not possible to simply re-use the versionPropertyNode here as it causes
//TODO: this class does too many things! we need a different
// TBD should this be varbinary($1)?
//TODO: should orphans really be deleted during lock???
// Does this dialect support FOR UPDATE OF
// todo : what else to do here?
come up with a better way to check this (plus see above comment)
// can happen because of the multiple ways Cache.remove()
// this will also (inefficiently) handle arrays
//TODO:  this is kinda slow...
//this is kinda the best we can do...
//TODO: Should this be an InitializeEntityEventListener??? (watch out for performance!)
// todo : add the notion of enabled filters to the CacheKey to differentiate filtered collections from non-filtered
//TODO: improve this hack!
how *should* this work for non-pojo entities?
// work around the "feature" where tree cache is validating the
// todo : we can remove this once the deprecated ctor can be made private...
// This inner class implements a case statement....perhaps im being a bit over-clever here
// TODO: is it really neceassry to provide Configuration to CollectionPersisters ?
// todo : modify the class definition if not already transformed...
// is this really necessary?
/** Create an action that will evict collection and entity regions based on queryspaces (table names).
// inheritance cycle detection (paranoid check)
//TODO: design new lifecycle for ProxyFactory
//ugly little workaround for fact that createUniqueKeyLoaders() does not handle component properties
// todo : eventually merge this with TreeCache and just add optional opt-lock support there.
// TODO: Replace this with a more elegant solution.
// should indicate that we are processing an INSERT/UPDATE/DELETE
//TODO: really bad
// this only works because collection entries are kept in a sequenced
     * FIXME Per the RegionFactory class Javadoc
// meant to handle dynamic instantiation queries...(Copy from QueryLoader)
// TODO : keep seperate notions of QT[] here for shallow/non-shallow queries...
//TODO: this is a bit arbitrary
// todo : should this get moved to PersistentContext?
// 'hibernate.temp.use_jdbc_metadata_defaults' is a temporary magic value
// todo: this might really even be moved into the cfg package and used as the basis for all things which are configurable.
// TODO: It would be really
// todo : remove this and just have subclasses use Isolater/IsolatedWork directly...
/* trim done to workaround stupid oracle bug that cant handle whitespaces before a { in a sp */
// todo : what is the implication of this?
//TODO: perhaps this does need to cascade after all....
//TODO: Somehow add the newly created foreign keys to the internal collection
//TODO: not quite sure about the full implications of this!
//TODO: implement functionality
but needed for collections with a "." node mapping
//TODO: temporary
cos it depends upon ordering of mapping doc
//note that i parameter is now unused (delete it?)
//TODO: COPY/PASTE FROM SessionImpl
//TODO: is this a bit ugly?
//TODO: inefficient
//TODO: refactor to .sql package
// we may be screwed here since the collection action is about to execute
// short-circuit for performance...
//swaldman 2004-02-07: modify to allow null values to signify fall through to c3p0 PoolConfig defaults
//TODO: the i==entitySpan-1 bit depends upon subclass implementation (very bad)
//TODO: move these to a new JoinableType abstract class
// No explicit select expression
// get the right object from the list ... would it be easier to just call getEntity() ??
//ie. the subquery! yuck!
// xmlforest requires a new kind of function constructor
//TODO: or an array!! we can't lock objects with arrays now??
// Sets can be just a view of a part of another collection
//name from a super query (a bit inelegant that it shows up here)
// Does this dialect support the UNIQUE column syntax?
// hack/workaround as sqlquery impl depend on having a key.
//TODO: reuse the PostLoadEvent...
// TODO : remove these last two as batcher is no longer managing connections
//TODO: better to pass the id in as an argument?
// append the SQL to return the generated identifier
// gets a chance to see all hibernate.c3p0.*
//TODO: is this really necessary????
//TODO: copy/paste from insertRows()
/* TODO: joinKeyColumnName & foreignKeyColumnName should be called either here or at a
//TODO: currently keeps Getters and Setters (instead of PropertyAccessors) because of the way getGetter()
//TODO: redesign how PropertyAccessors are acquired...
//TODO: is there a more elegant way than downcasting?
//TODO: We probably should have a StatisticsNotPublishedException
// is it necessary to register %exact since it can only appear in a where clause?
// TODO : not sure the best way to handle this
// todo : currently expects that the individual with expressions apply to the same sql table join
if only properties mapped to the "base table" are referenced
// Do we need to qualify index names with the schema name?
is used by SessionFactoryImpl to hand to the generated SessionImpl
// todo : should seriously consider not allowing a txn to begin from a child session
// TODO : an optimization here would be to consider cascade deletes and not gen those delete statements
//      needed because currently persister is the one that
// todo : i'd much rather have this done from #endLoadingCollection(CollectionPersister
//TODO: is this right??
//TODO: assumes all collections disassemble to an array!
// TODO : perhaps we should additionally require that the incoming entity
// Attempt to work around "ghost" ImpliedFromElements that occasionally
//TODO: I am not so sure about the exception handling in this bit!
// TODO: encapsulate the protected instance variables!
//TODO: better to degrade to lazy="false" if uninstrumented
// this class has no proxies (so do a shortcut)
//TODO: suck into event class
// this should be refactored to instead expose a method to assemble a EntityEntry based on this
// We would probably refactor to have LogicParser (builds a tree of simple
// VERY IMPORTANT!!!! - This class needs to be free of any static references
// todo : should we check the current isolation mode explicitly?
//TODO: this is a little inefficient
//TODO: suck this logic into the collection!
// todo : should we additionally check the current isolation mode explicitly?
// todo : potentially look at optimizing these two arrays
//TODO: need to make the majority of this functionality into a top-level support class for custom impl support
//TODO: should we use SELECT .. FOR UPDATE?
// NOTE: this assumes something about how propertySelectFragment is implemented by the subclass!
// TODO Why not use the timestamp in a DataVersion?
// TODO : safe to interpret "map.remove(key) == null" as non-dirty?
the incoming property could not be found so we
// TODO: shift it into unsaved-value strategy
// TODO Is this a valid operation on a timestamps cache?
//TODO: we use two visitors here
// we do not know either type
// TODO should we just collect these like with the collections above?
// would be better to use the element-type to determine
//TODO:refactor + make this method private
// TODO: cache the entity name somewhere so that it is available to this exception
//TODO race conditions can happen here
//TODO: i'm not sure
//do we even really need this? the update will fail anyway....
//put() has nowait semantics
// we have to set up the table later!! yuck
//TODO:this is only needed during compilation .. can we eliminate the instvar?
// Do we need to drop constraints before dropping tables in this dialect?
// TODO: something much better - look at the type of the other expression!
// FIXME hack to work around fact that calling
// orphans should not be deleted during copy??
// TODO : not so sure this is needed...
to account for newly saved entities in query
// todo: we should really just collect these from the various SelectExpressions
//TODO: should this be Session.instantiate(Persister
// TODO: Fix this so it will work for non-POJO entity mode
//TODO: move into collection type
// TODO : would be great to have a Mapping#hasNonIdentifierPropertyNamedId method
//TODO: this needn't exclude subclasses...
//FIXME: get the PersistentClass
// TODO : probably better to calculate these and pass them in
// implicit joins are always(?) ok to reuse
// short cut check...
at least needed this dropped after use
//TODO: optimize this better!
// TODO : will need reference to session factory to fully complete HHH-1907
// does this need holdlock also? : return tableName + " with (updlock
//TODO: inefficient if that cache is just going to ignore the updated state!
//TODO: can we *always* use the "null property" approach for everything?
//HSQL has no Blob/Clob support .... but just put these here for now!
//TODO: does this really need to be here?
//should this interface extend PropertyMapping?
// TODO: here is why we need to make bytecode provider global :(
//for backward compatibility
// todo : would love to have this work on a notification basis
* This form used from annotations (?).  Essentially the same as the above using a
//TODO: deprecated
//This is not very nice (and quite slow):
// work around that crazy issue where the tree contains
// TODO: it would be better if this was done at the higher level by Printer
"	 * FIXME: even if isInverse=""true""?"
//TODO: this class depends directly upon CriteriaImpl
// polymorphism not really handled completely correctly
// NONE might be a better option moving forward in the case of callable
* FIXME Per the RegionFactory class Javadoc
// todo : throw exception?  maybe warn if not the same?
//TODO possibly relax that
// TODO: should "record" how many properties we have reffered to - and if we
//TODO: used to be exprNoParens! was this needed?
//TODO: to handle concurrent writes correctly
//This is really ugly
// TODO: get SQL rendering out of here
// TODO : we really need to be able to deal with component paths here also
//use of trim() here is ugly?
for backward compatibility of sets with no
// not absolutely necessary
// try block is a hack around fact that currently tuplizers are not
// worrying about proxies is perhaps a little bit of overkill here...
// TODO: copy/paste from ManyToOneType
// todo : need to find a clean way to handle the "event source" role
//TODO: would it be better to simply pass the qualified table name
// Does this dialect support check constraints?
// TODO: an alternative is to check if the owner has changed
// todo : need map? the prob is a proper key
// Need a better way to define the suffixes here...
// create an index on the key columns??
//TODO: make this a bit nicer
//TODO: suck this into initLaziness!
//TODO: is there a better way?
// We should reengineer this class so that
//TODO: or we could do this polymorphically
//Icky workaround for MySQL bug:
//TODO: would be nice to handle proxy classes elegantly!
//TODO: switch statements are always evil! We already had bugs because
//create an index on the key columns??
//TODO: would it be better to do a refresh from db?
// TODO: Should this really return null?  If not
//need to do that here rather than in the save event listener to let
//TODO: should we allow suffixes on these ?
//TODO: perhaps this should be some other RuntimeException...
//yuck!
// todo : move to StringHelper?
//TODO: handle the case of a foreign key to something other than the pk
// TODO: The order in which entities are saved may matter (e.g.
//ick!
* TODO: This will need to be refactored at some point.
//TODO: ideally we need the construction of PropertyAccessor to take the following:
//TODO: reenable if we also fix the above todo
//TODO: add a CriteriaImplementor interface
// orphans should not be deleted during merge??
// at some point the generate phase needs to be moved out of here
// todo : should really move this log statement to CollectionType
// this is done here 'cos we might only know the type here (ugly!)
// todo : this eventually needs to be removed
//TODO: ugly here:
// really there are two situations where it should be ok to allow the insertion
//TODO: Yuck! This is not quite good enough
//TODO: need some caching scheme? really comes down to decision
//TODO: move to .sql package!!
//just to help out during the load (ugly
//TODO: this dependency is kinda Bad
//TODO: this bit actually has to be called after all cascades!
// from the collection of associations
// TODO : this constructor form is *only* used from constructor directly below us
// TODO : better way?!?
// FIXME Hacky workaround to JBCACHE-1202
//TODO: simply remove this override
//shortcut
// todo : remove
// used to count the nesting of parentheses
// TODO : we may also want to check that the types here map to exactly one column/JDBC-type
// TODO : most of below was taken verbatim from DotNode
// TODO : is there a way to tell whether a persister is truly discrim-column based inheritence?
//TODO: we should provide some way to get keys of collection of statistics to make it easier to retrieve from a GUI perspective
since getTypeName() actually throws an exception!
//TODO: get SQL rendering out of this package!
//TODO: is this 100% correct?
// this is called by SessionFactory irregardless
//is this ok?
// todo : is there really any reason to kkeep trying if this fails once?
//note there is a wierd implementation in the client side
// TODO : this really needs to be delayed unitl after we definitively know all node types
//hum ... should we cascade anyway? throw an exception? fine like it is?
//use of a stringbuffer to workaround a JDK bug
//TODO: if object was an uninitialized proxy
//workaround for WebLogic
// todo : we can actually just determine this from the incoming EntityEntry-s
//TODO: get SQL rendering out of here
//TODO: code duplication with SingleTableEntityPersister
//Yuck:
// todo : better to handle dynamic filters through implicit DynamicFilterParameterSpecification
//TODO: *two* hashmap lookups here is one too many...
//The class is now way to complex!
// would be great to move all this below here into another method that could also be used
// unhappy about this being public ... is there a better way?
// TODO : should remove this exposure
// TODO: this is a bit of copy/paste from IndexedCollection.createPrimaryKey()
// NOTE : here we cleanup the load context when we have no more local
//TODO: code duplication with JoinedSubclassEntityPersister
//TODO: remove use of instanceof!
//TODO: disable batch loading if lockMode > READ?
// TODO : make this the factory for "entity mode related" sessions
//perhaps not really necessary...
// why does this matter?
//work around a bug in all known connection pools....
//TODO: implement caching?! proxies?!
// TODO : add this info to the translator and aggregate it here...
// TODO : YUCK!!!  fix after HHH-1907 is complete
// perhaps this should be an exception since it is only ever used
//TODO: this is too conservative
//use a degenerated strategy for backward compatibility
// TODO: I considered validating TS cache config here
// yuck!
// TODO: what type?
// Does this dialect support the FOR UPDATE syntax?
//TODO: merge into one method!
//TODO: copy/paste from recreate()
// TODO: Figure out a better way to get the FROM elements in a proper tree structure
// TODO : not sure this is correct
//TODO: make EntityPersister *not* depend on SessionFactoryImplementor
// TODO : what amount of significant digits need to be supported here?
// TODO: this is very suboptimal for some subclasses (namely components)
//TODO: put this stuff back in to read snapshot from
// todo : throw exception?
// Put a placeholder in entries
//it is possible that the tree-walking in OuterJoinLoader can get to
// TODO : absolutely no usages of this constructor form
//TODO: move to .sql package
// TODO: Downcast to avoid using an interface?  Yuck.
//I suppose?
// TODO: I considered validating the presence of the TS cache here
//Must be done here because of side-effect! yuck...
// ugly hack for cases like "elements(foo.bar.collection)"
// todo : obviously get rid of all this junk
//TODO: we should throw an exception if we really *know* for sure
//TODO: this is one of the ugliest and most fragile pieces of code in Hibernate....
// yick!  need this for proper serialization/deserialization handling...
// this is ugly here
// TODO: what should be the actual exception type here?
//TODO: this is temporary in that the end result will probably not take a Property reference per-se.
// TODO : would be really nice to cache the spec on the query-def so as to not have to re-calc the hash
//We should actually rework this class to not implement Parser
// should leading trim-characters be trimmed?
//TODO: look at the owning property and check that it
//TODO: reuse the PreLoadEvent
//TODO: is it kosher to do it here?
// todo : YUCK!!!
// Does this dialect support the ALTER TABLE syntax?
complex stuff here
//note that this method could easily be moved up to BasicEntityPersister
// Does this dialect support the Oracle-style FOR UPDATE NOWAIT syntax?